# コード実行用 MCP 要件定義

*作成日: 2026年1月*

---

## 概要

GROWI MCP のトークン消費削減のため、分離型アプローチを採用する。
本ドキュメントでは、外部のコード実行用 MCP サーバーに求められる要件を定義する。

### 背景

- **採用方式**: コード実行方式（Anthropic 提唱）+ 分離型アーキテクチャ
- **目的**: GROWI MCP は API 提供に専念し、コード実行は専門のサーバーに委譲
- **期待効果**: トークン消費 最大98%削減

詳細は [decision.md](../decision.md) を参照。

---

## 要件一覧

### 必須要件（Must）

| ID | カテゴリ | 要件 | 理由 |
|----|----------|------|------|
| M1 | 基本機能 | コードを受け取り実行結果を返却できる | 中間データを実行環境内で処理し、最終結果のみ返すため |
| M2 | MCP連携 | 実行環境内から他の MCP サーバーを呼び出せる | GROWI MCP のツールをコード内で利用するため |
| M3 | セキュリティ | サンドボックス環境での実行 | 悪意あるコード・無限ループ等からの保護 |
| M4 | 出力制御 | console.log 等の出力を LLM に返却できる | 必要な情報のみを LLM に伝達するため |

### 重要要件（Should）

| ID | カテゴリ | 要件 | 理由 |
|----|----------|------|------|
| S1 | 言語 | JavaScript/TypeScript サポート | GROWI MCP（Node.js ベース）との親和性 |
| S2 | パフォーマンス | 低レイテンシな実行 | 会話の応答性を維持 |
| S3 | 運用 | Claude Desktop との互換性 | 実際の利用環境への導入容易性 |
| S4 | 保守 | 既存実装・メンテナンス済みのプロジェクト | 自前でサンドボックス脆弱性対応をしなくて済む |

### あると望ましい要件（Nice to have）

| ID | カテゴリ | 要件 | 理由 |
|----|----------|------|------|
| N1 | 拡張性 | 複数言語サポート（Python 等） | 将来的な用途拡大 |
| N2 | 状態管理 | セッション間での状態保持 | 複雑な処理の継続実行 |
| N3 | ファイル操作 | 一時ファイルの読み書き | データ加工・中間保存 |

---

## 技術的補足

### M2（MCP連携）について

この要件が技術的に最も重要なポイントとなる。

**実現パターン:**

1. **MCP クライアント内蔵型**: 実行環境自体が MCP クライアント機能を持ち、他の MCP サーバーを呼び出せる
2. **HTTP/API 経由型**: GROWI MCP が HTTP エンドポイントを公開し、実行環境からは通常の HTTP リクエストで呼び出す
3. **SDK 提供型**: 実行環境内で利用可能な MCP クライアント SDK が提供されている

選定時には、候補となる MCP サーバーがどのパターンで連携可能かを確認する必要がある。

---

## 関連ドキュメント

| ドキュメント | 内容 |
|--------------|------|
| [decision.md](../decision.md) | 採用方針の決定内容 |
| [architecture.md](../architecture.md) | アーキテクチャ設計 |
| [code-interpreter-mcp.md](./code-interpreter-mcp.md) | Code Interpreter MCP 調査 |
